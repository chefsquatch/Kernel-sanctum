<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Kernel AI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* … your existing styles … */
  </style>
</head>
<body>
  <div id="chatbox"></div>
  <input id="input" placeholder="Type…" />
  <button id="send">Send</button>
  <button id="learn">Learn</button>
  <button id="settings">⚙️</button>

  <script type="module">
    import { sendKernelMessage, learnSubject, setMode, saveApiKey, getApiKey } from './src/KernelEngine.js';

    const chatbox = document.getElementById('chatbox');
    const input   = document.getElementById('input');

    let messages = [{ kernel: 'Welcome! How can I help you?' }];

    function render() {
      chatbox.innerHTML = '';
      messages.forEach(m => {
        const div = document.createElement('div');
        div.className = m.user ? 'user-msg' : 'kernel-msg';
        div.textContent = m.user || m.kernel;
        chatbox.appendChild(div);
      });
      chatbox.scrollTop = chatbox.scrollHeight;
    }
    render();

    document.getElementById('send').onclick = async () => {
      const text = input.value.trim();
      if (!text) return;
      messages.push({ user: text }); render();
      input.value = '';
      await sendKernelMessage(text, reply => {
        messages.push({ kernel: reply });
        render();
      });
    };

    document.getElementById('learn').onclick = async () => {
      const subject = prompt('What subject?');
      if (!subject) return;
      messages.push({ user: 'learn subject: ' + subject }); render();
      const r = await learnSubject(subject);
      messages.push({ kernel: r }); render();
    };

    document.getElementById('settings').onclick = () => {
      const k = prompt('API Key:', getApiKey()||'');
      if (k !== null) {
        saveApiKey(k);
        setMode(k ? 'online' : 'offline');
        messages.push({ kernel: 'Settings updated.' });
        render();
      }
    };
  </script>
</body>
</html>